<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PerformanceHub | AI Employee Evaluation</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #64748b;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #1e293b;
            --light: #f8fafc;
            --border: #e2e8f0;
            --sidebar: #1e293b;
            --card-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }

        body {
            background: #f1f5f9;
            color: #334155;
        }

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 260px;
            background: var(--sidebar);
            color: white;
        }

        .sidebar-header {
            padding: 24px 20px;
            border-bottom: 1px solid #334155;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 20px;
            font-weight: 700;
        }

        .nav-links {
            padding: 20px 0;
        }

        .nav-item {
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #cbd5e1;
            text-decoration: none;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }

        .nav-item:hover, .nav-item.active {
            background: #334155;
            color: white;
            border-left-color: var(--primary);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .top-header {
            background: white;
            padding: 16px 30px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--card-shadow);
        }

        .search-bar {
            display: flex;
            align-items: center;
            background: var(--light);
            border-radius: 8px;
            padding: 8px 16px;
            width: 400px;
        }

        .search-bar input {
            border: none;
            background: none;
            outline: none;
            margin-left: 8px;
            width: 100%;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        /* Content */
        .content {
            padding: 30px;
            flex: 1;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .page-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--dark);
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-outline {
            background: white;
            color: var(--secondary);
            border: 1px solid var(--border);
        }

        /* Cards */
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: var(--card-shadow);
            margin-bottom: 24px;
            overflow: hidden;
        }

        .card-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--border);
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--dark);
        }

        .card-body {
            padding: 24px;
        }

        /* Form */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* Criteria */
        .criteria-section {
            background: var(--light);
            padding: 20px;
            border-radius: 8px;
            margin: 24px 0;
        }

        .criteria-item {
            margin-bottom: 24px;
            padding: 16px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid var(--primary);
        }

        .criteria-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .criteria-name {
            font-weight: 600;
            color: var(--dark);
        }

        .score-container {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .score-input {
            width: 80px;
            text-align: center;
            font-weight: 600;
        }

        .score-slider {
            flex: 1;
            height: 6px;
            background: #e2e8f0;
            border-radius: 3px;
            outline: none;
        }

        .score-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
        }

        /* Results */
        .results-panel {
            display: none;
            margin-top: 30px;
        }

        .executive-summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 24px;
        }

        .analysis-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: var(--card-shadow);
            margin-bottom: 20px;
        }

        .metric-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 12px;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f1f1f1;
        }

        .pattern-tag, .trait-tag {
            background: #e0f2fe;
            padding: 4px 8px;
            border-radius: 16px;
            font-size: 12px;
            margin: 2px;
            display: inline-block;
        }

        .trait-tag {
            background: #dcfce7;
        }

        .risk-item {
            padding: 8px;
            border-radius: 6px;
            text-align: center;
        }

        .risk-item.low { background: #dcfce7; }
        .risk-item.medium { background: #fef3c7; }
        .risk-item.high { background: #fee2e2; }

        .gap-item {
            background: #fee2e2;
            padding: 12px;
            border-radius: 8px;
            margin: 8px 0;
        }

        .priority-item {
            background: #f0f9ff;
            padding: 10px;
            border-radius: 6px;
            margin: 6px 0;
        }

        .insight-item {
            background: #f8fafc;
            padding: 12px;
            border-radius: 8px;
        }

        .insight-desc {
            font-size: 12px;
            color: #64748b;
            margin-top: 4px;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-brain"></i>
                    <span>AI PerformanceHub</span>
                </div>
            </div>
            <div class="nav-links">
                <a href="#" class="nav-item active">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </a>
               
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="top-header">
                <div class="search-bar">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Search employees, reports...">
                </div>
                <div class="user-menu">
                    <div class="user-avatar">AI</div>
                </div>
            </div>

            <div class="content">
                <div class="page-header">
                    <h1 class="page-title">AI-Powered Performance Evaluation</h1>
                    <div class="page-actions">
                        <button class="btn btn-outline">
                            <i class="fas fa-download"></i>
                            Export Data
                        </button>
                    </div>
                </div>

                <!-- Evaluation Form -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-robot"></i>
                            Employee Evaluation Input
                        </h2>
                    </div>
                    <div class="card-body">
                        <form id="evaluationForm">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">Employee Name</label>
                                    <input type="text" class="form-control" name="employee_name" placeholder="John Doe" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Employee ID</label>
                                    <input type="text" class="form-control" name="employee_id" placeholder="EMP-001" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Department</label>
                                    <select class="form-control" name="department" required>
                                        <option value="">Select Department</option>
                                        <option value="Engineering">Engineering</option>
                                        <option value="Marketing">Marketing</option>
                                        <option value="Sales">Sales</option>
                                        <option value="HR">Human Resources</option>
                                        <option value="Finance">Finance</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Position</label>
                                    <input type="text" class="form-control" name="position" placeholder="Software Engineer" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Review Period</label>
                                    <select class="form-control" name="period" required>
                                        <option value="Q1 2024">Q1 2024</option>
                                        <option value="Q2 2024">Q2 2024</option>
                                        <option value="Q3 2024">Q3 2024</option>
                                        <option value="Q4 2024">Q4 2024</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Tenure (Months)</label>
                                    <input type="number" class="form-control" name="tenure_months" value="12" min="1" required>
                                </div>
                            </div>

                            <!-- Performance Criteria -->
                            <div class="criteria-section">
                                <h3 style="margin-bottom: 20px; color: var(--dark);">
                                    <i class="fas fa-tasks"></i>
                                    Performance Assessment (Rate 1-10)
                                </h3>
                                
                                <div class="criteria-item">
                                    <div class="criteria-header">
                                        <div class="criteria-name">Quality of Work</div>
                                    </div>
                                    <div class="score-container">
                                        <input type="range" class="score-slider" name="quality_of_work" min="1" max="10" value="5">
                                        <input type="number" class="form-control score-input" name="quality_of_work_display" min="1" max="10" value="5" readonly>
                                    </div>
                                </div>

                                <div class="criteria-item">
                                    <div class="criteria-header">
                                        <div class="criteria-name">Productivity & Efficiency</div>
                                    </div>
                                    <div class="score-container">
                                        <input type="range" class="score-slider" name="productivity" min="1" max="10" value="5">
                                        <input type="number" class="form-control score-input" name="productivity_display" min="1" max="10" value="5" readonly>
                                    </div>
                                </div>

                                <div class="criteria-item">
                                    <div class="criteria-header">
                                        <div class="criteria-name">Teamwork & Collaboration</div>
                                    </div>
                                    <div class="score-container">
                                        <input type="range" class="score-slider" name="teamwork" min="1" max="10" value="5">
                                        <input type="number" class="form-control score-input" name="teamwork_display" min="1" max="10" value="5" readonly>
                                    </div>
                                </div>

                                <div class="criteria-item">
                                    <div class="criteria-header">
                                        <div class="criteria-name">Communication Skills</div>
                                    </div>
                                    <div class="score-container">
                                        <input type="range" class="score-slider" name="communication" min="1" max="10" value="5">
                                        <input type="number" class="form-control score-input" name="communication_display" min="1" max="10" value="5" readonly>
                                    </div>
                                </div>

                                <div class="criteria-item">
                                    <div class="criteria-header">
                                        <div class="criteria-name">Initiative & Innovation</div>
                                    </div>
                                    <div class="score-container">
                                        <input type="range" class="score-slider" name="initiative" min="1" max="10" value="5">
                                        <input type="number" class="form-control score-input" name="initiative_display" min="1" max="10" value="5" readonly>
                                    </div>
                                </div>
                            </div>

                            <div style="text-align: center; margin-top: 32px;">
                                <button type="submit" class="btn btn-primary" id="submitBtn" style="padding: 12px 40px;">
                                    <i class="fas fa-brain"></i>
                                    Run Analysis
                                </button>
                            </div>
                        </form>

                        <div class="loading" id="loading">
                            <div class="spinner"></div>
                            <p>AI is analyzing performance patterns...</p>
                            <small>Running 7-layer analysis with predictive algorithms</small>
                        </div>
                    </div>
                </div>

                <!-- Results Panel -->
                <div class="results-panel" id="resultsPanel">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-chart-network"></i>
                                AI Performance Intelligence Report
                            </h2>
                            <div class="page-actions">
                                <button class="btn btn-outline" onclick="window.print()">
                                    <i class="fas fa-print"></i>
                                    Print Report
                                </button>
                                <button class="btn btn-primary" onclick="location.reload()">
                                    <i class="fas fa-redo"></i>
                                    New Analysis
                                </button>
                            </div>
                        </div>
                        <div class="card-body" id="resultsBody">
                            <!-- Results will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize sliders and sync with number inputs
        document.addEventListener('DOMContentLoaded', function() {
            initializeSliders();
            setupFormSubmission();
        });
    
        function initializeSliders() {
            document.querySelectorAll('.score-slider').forEach(slider => {
                const displayInput = document.querySelector(`[name="${slider.name}_display"]`);
                
                slider.addEventListener('input', function() {
                    displayInput.value = this.value;
                    updateSliderColor(this);
                });
    
                // Initialize colors
                updateSliderColor(slider);
            });
        }
    
        function updateSliderColor(slider) {
            const value = (slider.value - slider.min) / (slider.max - slider.min) * 100;
            slider.style.background = `linear-gradient(to right, #2563eb 0%, #2563eb ${value}%, #e2e8f0 ${value}%, #e2e8f0 100%)`;
        }
    
        function setupFormSubmission() {
            document.getElementById('evaluationForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const submitBtn = document.getElementById('submitBtn');
                const loading = document.getElementById('loading');
                const resultsPanel = document.getElementById('resultsPanel');
                
                // Show loading state
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<i class="fas fa-cog fa-spin"></i> Processing...';
                loading.style.display = 'block';
                
                try {
                    const formData = new FormData(this);
                    const scores = {
                        quality_of_work: parseInt(formData.get('quality_of_work')),
                        productivity: parseInt(formData.get('productivity')),
                        teamwork: parseInt(formData.get('teamwork')),
                        communication: parseInt(formData.get('communication')),
                        initiative: parseInt(formData.get('initiative'))
                    };
    
                    // Prepare data for API
                    const submitData = new FormData();
                    submitData.append('employee_name', formData.get('employee_name'));
                    submitData.append('employee_id', formData.get('employee_id'));
                    submitData.append('department', formData.get('department'));
                    submitData.append('position', formData.get('position'));
                    submitData.append('period', formData.get('period'));
                    submitData.append('tenure_months', formData.get('tenure_months'));
                    submitData.append('reviewer_name', 'AI Evaluation System');
                    
                    for (const [key, value] of Object.entries(scores)) {
                        submitData.append(key, value);
                    }
    
                    // Send to backend
                    const response = await fetch('/evaluate', {
                        method: 'POST',
                        body: submitData
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const result = await response.json();
                    displayAdvancedResults(result);
                    
                } catch (error) {
                    console.error('Error:', error);
                    alert('Error submitting evaluation: ' + error.message);
                } finally {
                    // Reset loading state
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = '<i class="fas fa-brain"></i> Run AI Analysis';
                    loading.style.display = 'none';
                }
            });
        }
    
        function displayAdvancedResults(data) {
            if (data.error) {
                alert('AI Analysis Error: ' + data.error);
                return;
            }
            
            const resultsBody = document.getElementById('resultsBody');
            const resultsPanel = document.getElementById('resultsPanel');
            
            // Generate comprehensive AI report
            resultsBody.innerHTML = generateAIReport(data);
            
            resultsPanel.style.display = 'block';
            resultsPanel.scrollIntoView({ behavior: 'smooth' });
            
            // Add analytics tracking
            console.log('AI Analysis Completed:', {
                overallScore: data.overall_score,
                performanceLevel: data.performance_level?.level,
                confidence: data.analysis_confidence?.level
            });
        }
    
        // Helper function to format skill names properly
        function formatSkillName(skill) {
            if (!skill) return 'Unknown Skill';
            return skill.replace(/_/g, ' ')
                       .split(' ')
                       .map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())
                       .join(' ');
        }
    
        // Helper function to safely get array values
        function safeArray(array) {
            return Array.isArray(array) ? array : [];
        }
    
        // Helper function to safely get object values
        function safeObject(obj) {
            return obj && typeof obj === 'object' ? obj : {};
        }
    
        function generateAIReport(data) {
            // Safely handle data with fallbacks
            const performanceLevel = safeObject(data.performance_level);
            const analysisConfidence = safeObject(data.analysis_confidence);
            const growthPotential = safeObject(data.growth_potential);
            const promotionReadiness = safeObject(data.promotion_readiness);
            const performanceTrajectory = safeObject(data.performance_trajectory);
            const developmentTimeline = safeObject(data.development_timeline);
            const tenureBenchmark = safeObject(data.tenure_benchmark);
            const industryBenchmark = safeObject(data.industry_benchmark);
            const competitivePositioning = safeObject(data.competitive_positioning);
            const burnoutRisk = safeObject(data.burnout_risk);
            const attritionRisk = safeObject(data.attrition_risk);
            const performanceVolatility = safeObject(data.performance_volatility);
    
            const criticalSkillGaps = safeArray(data.critical_skill_gaps);
            const improvementPriority = safeArray(data.improvement_priority);
            const detectedPatterns = safeArray(data.detected_patterns);
            const dominantTraits = safeArray(data.dominant_traits);
            const aiClassification = safeArray(data.ai_classification);
            const mitigationRecommendations = safeArray(data.mitigation_recommendations);
    
            return `
                <!-- Executive Summary -->
                <div class="executive-summary">
                    <h2 style="margin-bottom: 16px; display: flex; align-items: center; gap: 12px;">
                        <i class="fas fa-robot"></i>
                        AI Performance Intelligence Report
                    </h2>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                        <div>
                            <div style="font-size: 32px; font-weight: 700;">${data.overall_score || 0}/10</div>
                            <div>Overall Score</div>
                        </div>
                        <div>
                            <div style="font-size: 24px; font-weight: 600;">${performanceLevel.level || 'N/A'}</div>
                            <div>Performance Level</div>
                        </div>
                        <div>
                            <div style="font-size: 24px; font-weight: 600;">${analysisConfidence.level || 'N/A'}</div>
                            <div>AI Confidence</div>
                        </div>
                        <div>
                            <div style="font-size: 24px; font-weight: 600;">${growthPotential.level || 'N/A'}</div>
                            <div>Growth Potential</div>
                        </div>
                    </div>
                    <div style="margin-top: 16px; font-size: 14px; opacity: 0.9;">
                        Employee: ${data.name || 'N/A'} | Department: ${data.department || 'N/A'} | Period: ${data.period || 'N/A'}
                    </div>
                </div>
    
                <!-- Multi-Layer Analysis Grid -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 24px;">
                    <!-- Performance Analytics -->
                    <div class="analysis-card">
                        <h3 style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px;">
                            <i class="fas fa-chart-line"></i>
                            Performance Analytics
                        </h3>
                        <div class="metric-grid">
                            <div class="metric">
                                <span class="metric-label">Weighted Score</span>
                                <span class="metric-value">${data.weighted_score || data.overall_score || 0}/10</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">Score Consistency</span>
                                <span class="metric-value">${data.score_consistency || 'N/A'}</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">Performance Stability</span>
                                <span class="metric-value">${data.performance_stability || 'N/A'}/10</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">Performance Percentile</span>
                                <span class="metric-value">Top ${performanceLevel.percentile || 'N/A'}%</span>
                            </div>
                        </div>
                        
                        <!-- Detailed Scores -->
                        <div style="margin-top: 16px;">
                            <h4 style="margin-bottom: 12px;">Detailed Performance Metrics</h4>
                            ${Object.entries(data.detailed_scores || {}).map(([key, value]) => `
                                <div class="metric">
                                    <span class="metric-label">${formatSkillName(key)}</span>
                                    <span class="metric-value">${value}/10</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
    
                    <!-- AI Pattern Recognition -->
                    <div class="analysis-card">
                        <h3 style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px;">
                            <i class="fas fa-brain"></i>
                            AI Pattern Recognition
                        </h3>
                        <div style="margin-bottom: 16px;">
                            <strong>Detected Performance Patterns:</strong>
                            <div style="margin-top: 8px;">
                                ${detectedPatterns.length > 0 ? detectedPatterns.map(pattern => 
                                    `<span class="pattern-tag">${pattern}</span>`
                                ).join('') : '<span class="pattern-tag">Standard Performance Pattern</span>'}
                            </div>
                        </div>
                        <div>
                            <strong>Dominant Behavioral Traits:</strong>
                            <div style="margin-top: 8px;">
                                ${dominantTraits.length > 0 ? dominantTraits.map(trait => 
                                    `<span class="trait-tag">${trait}</span>`
                                ).join('') : '<span class="trait-tag">Balanced Performer</span>'}
                            </div>
                        </div>
                        <div style="margin-top: 16px; padding: 12px; background: #f0f9ff; border-radius: 8px;">
                            <strong>AI Classification:</strong> ${aiClassification.length > 0 ? aiClassification.join(', ') : 'Standard Performer'}
                        </div>
                    </div>
                </div>
    
                <!-- Predictive Insights -->
                <div class="analysis-card">
                    <h3 style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px;">
                        <i class="fas fa-crystal-ball"></i>
                        Predictive Insights & Forecasting
                    </h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px;">
                        <div class="insight-item">
                            <strong>Growth Potential:</strong> ${growthPotential.level || 'N/A'}
                            <div class="insight-desc">${growthPotential.recommendation || 'Further assessment needed'}</div>
                        </div>
                        <div class="insight-item">
                            <strong>Promotion Readiness:</strong> ${promotionReadiness.ready ? 'Ready' : 'Developing'}
                            <div class="insight-desc">Timeline: ${promotionReadiness.timeline || 'N/A'} | Confidence: ${promotionReadiness.confidence || 'N/A'}</div>
                        </div>
                        <div class="insight-item">
                            <strong>Performance Trajectory:</strong> ${performanceTrajectory.trend || 'N/A'}
                            <div class="insight-desc">Outlook: ${performanceTrajectory.outlook || 'N/A'} | Momentum: ${performanceTrajectory.momentum || 'N/A'}</div>
                        </div>
                        <div class="insight-item">
                            <strong>Development Timeline:</strong> ${developmentTimeline.estimated_timeline || 'N/A'}
                            <div class="insight-desc">Learning Velocity: ${data.learning_velocity || 'Baseline established'}</div>
                        </div>
                    </div>
                </div>
    
                <!-- Skill Gap Analysis -->
                <div class="analysis-card">
                    <h3 style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px;">
                        <i class="fas fa-exclamation-triangle"></i>
                        Skill Gap Analysis
                    </h3>
                    ${criticalSkillGaps.length > 0 ? `
                        <div style="margin-bottom: 16px;">
                            <strong>Critical Gaps Requiring Immediate Attention:</strong>
                            ${criticalSkillGaps.map(gap => `
                                <div class="gap-item">
                                    <strong>${formatSkillName(gap.skill)}</strong> (Current Score: ${gap.current_score || 0}/10)
                                    <div style="margin-top: 4px;">Severity: ${gap.gap_severity || 'N/A'} | Business Impact: ${gap.business_impact || 'N/A'}</div>
                                    <div style="margin-top: 4px; font-size: 14px;">
                                        <strong>Recommended Action:</strong> ${gap.recommended_action || 'Skill development needed'}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    ` : '<p style="color: var(--success); margin-bottom: 16px;">✅ No critical skill gaps detected. Performance is well-balanced across all areas.</p>'}
                    
                    <div>
                        <strong>Improvement Priority (AI Recommended):</strong>
                        ${improvementPriority.length > 0 ? improvementPriority.map(priority => `
                            <div class="priority-item">
                                <strong>${formatSkillName(priority.skill)}</strong> 
                                | Priority Score: ${priority.priority_score || 0} 
                                | Urgency: ${priority.improvement_urgency || 'Medium'}
                                <div style="font-size: 12px; color: var(--secondary); margin-top: 2px;">
                                    Current: ${priority.current_level || 'N/A'} → Target: ${priority.target_level || 'N/A'}
                                </div>
                            </div>
                        `).join('') : '<p style="color: var(--secondary); margin-top: 8px;">No specific improvement priorities identified.</p>'}
                    </div>
                </div>
    
                <!-- Benchmarking & Risk Assessment -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 24px;">
                    <!-- Benchmarking -->
                    <div class="analysis-card">
                        <h3 style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px;">
                            <i class="fas fa-chart-bar"></i>
                            Multi-Dimensional Benchmarking
                        </h3>
                        <div style="display: grid; gap: 12px;">
                            <div class="insight-item">
                                <strong>Tenure Benchmark:</strong> ${tenureBenchmark.status || 'N/A'}
                                <div class="insight-desc">
                                    Group: ${tenureBenchmark.tenure_group || 'N/A'} | 
                                    Actual: ${tenureBenchmark.actual_score || 'N/A'}/10 | 
                                    Benchmark: ${tenureBenchmark.benchmark_score || 'N/A'}/10
                                </div>
                            </div>
                            <div class="insight-item">
                                <strong>Industry Position:</strong> ${industryBenchmark.status || 'N/A'}
                                <div class="insight-desc">${industryBenchmark.insight || 'Comparative analysis pending'}</div>
                            </div>
                            <div class="insight-item">
                                <strong>Competitive Positioning:</strong> ${competitivePositioning.position || 'N/A'}
                                <div class="insight-desc">Differentiators: ${competitivePositioning.differentiators ? competitivePositioning.differentiators.join(', ') : 'N/A'}</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Risk Assessment -->
                    <div class="analysis-card">
                        <h3 style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px;">
                            <i class="fas fa-shield-alt"></i>
                            Risk Assessment
                        </h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                            <div class="risk-item ${(burnoutRisk.risk_level || 'low').toLowerCase()}">
                                <strong>Burnout Risk:</strong> ${burnoutRisk.risk_level || 'Low'}
                                <div class="insight-desc">${burnoutRisk.factors ? burnoutRisk.factors[0] : 'Good work-life balance indicators'}</div>
                            </div>
                            <div class="risk-item ${(attritionRisk.risk_level || 'low').toLowerCase()}">
                                <strong>Attrition Risk:</strong> ${attritionRisk.risk_level || 'Low'}
                                <div class="insight-desc">Retention Probability: ${attritionRisk.retention_probability || 'High'}</div>
                            </div>
                            <div class="risk-item ${(performanceVolatility.risk_level || 'low').toLowerCase()}">
                                <strong>Volatility Risk:</strong> ${performanceVolatility.risk_level || 'Low'}
                                <div class="insight-desc">Stability: ${performanceVolatility.stability || 'High consistency'}</div>
                            </div>
                        </div>
                        ${mitigationRecommendations.length > 0 ? `
                            <div style="margin-top: 16px; padding: 12px; background: #f0f9ff; border-radius: 8px;">
                                <strong>Risk Mitigation Recommendations:</strong>
                                <ul style="margin-top: 8px; padding-left: 20px;">
                                    ${mitigationRecommendations.map(rec => `<li>${rec}</li>`).join('')}
                                </ul>
                            </div>
                        ` : ''}
                    </div>
                </div>
    
                <!-- Technical Details -->
                <div class="analysis-card" style="background: #f8f9fa; font-size: 12px; color: #666;">
                    <h3 style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
                        <i class="fas fa-cogs"></i>
                        AI System Details
                    </h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 8px;">
                        <div><strong>Evaluation ID:</strong> ${data.evaluation_id || 'N/A'}</div>
                        <div><strong>AI Model Version:</strong> ${data.ai_model_version || 'v2.1.0'}</div>
                        <div><strong>Analysis Confidence:</strong> ${analysisConfidence.score || 'N/A'} (${analysisConfidence.level || 'N/A'})</div>
                        <div><strong>Analysis Timestamp:</strong> ${data.evaluation_timestamp || 'N/A'}</div>
                    </div>
                    <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid #e2e8f0;">
                        <strong>Analysis Layers:</strong> 7 | <strong>Data Points Analyzed:</strong> 28+ | <strong>AI Algorithms:</strong> Pattern Recognition, Predictive Analytics, Risk Assessment
                    </div>
                </div>
    
                <!-- Action Buttons -->
                <div style="text-align: center; margin-top: 32px; padding-top: 24px; border-top: 1px solid var(--border);">
                    
                    <button class="btn btn-outline" onclick="shareResults()">
                        <i class="fas fa-share"></i>
                        Share Results
                    </button>
                </div>
            `;
        }
    
        // Additional utility functions
        function generatePDFReport() {
            alert('PDF report generation would be implemented here with a proper PDF library');
            // In a real implementation, this would use libraries like jsPDF or html2pdf
        }
    
        function shareResults() {
            if (navigator.share) {
                navigator.share({
                    title: 'AI Performance Evaluation Report',
                    text: 'Check out this comprehensive AI-powered performance analysis',
                    url: window.location.href
                });
            } else {
                alert('Share functionality requires a modern browser with Web Share API support');
            }
        }
    
        // Performance analytics helper
        function calculatePerformanceTrend(scores) {
            if (!scores || typeof scores !== 'object') return 'Unknown';
            const values = Object.values(scores);
            if (values.length === 0) return 'Unknown';
            
            const avg = values.reduce((a, b) => a + b, 0) / values.length;
            if (avg >= 8.5) return 'Rising Star';
            if (avg >= 7.0) return 'Steady Performer';
            if (avg >= 5.5) return 'Developing';
            return 'Needs Support';
        }
    
        // Real-time analytics (could be connected to a backend service)
        function trackAnalytics(event, data) {
            console.log('AI Analytics Event:', event, data);
            // In production, this would send data to analytics service
        }
    
        // Initialize analytics
        trackAnalytics('page_loaded', { 
            page: 'performance_evaluation',
            timestamp: new Date().toISOString() 
        });
    </script>
</body>
</html>